"use strict";var TpfHome=function(){var s,t,u,v,w,a=document.getElementById("park-list").getElementsByTagName("li"),b=a.length,c=[],d=!1,g=($('meta[name="csrf-token"]').attr("content"),!0),h=$(".loading-screen"),i=$(".loading-screen-small"),j=0,k=Math.random()+"",m=(parseInt(k.replace(".","")),6e4),n=!1,o=[],p="https://www.parkstoronto.ca/images/leaf_square_icon.png",q="https://www.parkstoronto.ca/images/check.svg",r=[],x=function(){for(var c=0;c<b;c++){var d=a[c].id,e=a[c].getAttribute("data-parkval");$("#"+d).css({"background-image":"url(../public/images/"+e+".jpg)"})}},y=function(){for(var c=0;c<b;c++)a[c].addEventListener("click",function(){E(this),N()},!1);window.addEventListener("load",function(){setTimeout(function(){window.addEventListener("popstate",function(a){C()},!1)},0)})},z=function(){document.getElementById("find-all").addEventListener("click",function(){J(h),L(O,c)},!1)},A=function(){$("#park-find-btn").click(function(){d&&I()})},B=function(){$("#park-reset-btn").click(function(){d&&M()})},C=function(){var a=history.state;null!==a?(v=a.data,o=a.location,j=a.checkpoint,r=a.park_memory,g=!0,S()):(g=!1,S())},D=function(){var a=q;(new Image).src=a},E=function(a){var b=a.getAttribute("data-selected"),c=a.id;0==b?(ca(c,".5",1,"block"),F(a,c)):(ca(c,".9",0,"none"),G(c))},F=function(a,b){var c=a.getAttribute("data-nicename");$(".chosen-park-list").css({display:"block"}),$(".chosen-park-list ul").prepend("<li id='chosenlist-"+b+"' class='fade-in-and-up'><i class='fa fa-times' aria-hidden='true'></i> "+c+"</li>"),document.getElementById("chosenlist-"+b).addEventListener("click",function(){E(a),N()},!1)},G=function(a){$("#chosenlist-"+a).remove(),$(".chosen-park-list ul").has("li").length||$(".chosen-park-list").css({display:"none"})},H=function(){$(".chosen-park-list").css({display:"none"}),$(".chosen-park-list ul").empty()},I=function(){for(var d=0;d<b;d++)1==a[d].getAttribute("data-selected")&&c.push(a[d].getAttribute("data-parkvaloffish"));J(h),L(O,c),c=[]},J=function(a){a.removeClass("ani-fadeOutZindex").addClass("ani-fadeInZindex")},K=function(a){a.removeClass("ani-fadeInZindex").addClass("ani-fadeOutZindex")},L=function(a,b){var f={enableHighAccuracy:!1,timeout:7500,maximumAge:0};if(navigator.geolocation)if(!0===n)a(b);else{var g=setTimeout(function(){$("#location-fail").show()},8e3);navigator.geolocation.getCurrentPosition(function(c){$("#location-fail").hide(),clearTimeout(g),o=[];var d=c.coords.latitude,e=c.coords.longitude;o.push(d,e),n=!0,s=setTimeout(function(){n=!1},m),a(b)},function(a){switch($("#location-fail").hide(),clearTimeout(g),K(h),a.code){case a.PERMISSION_DENIED:alert("Unfortunately, you have chosen to deny the request for Geolocation services.");break;case a.POSITION_UNAVAILABLE:alert("Your location information is unavailable at this moment. Please try again later.");break;case a.TIMEOUT:alert("The request to get your location timed out. Please try again.");break;case a.UNKNOWN_ERROR:alert("An unknown error occurred. Please try again.")}},f)}else alert("Unfortunately, your browser cannot get your location. Please update or switch browsers and try again.")},M=function(){for(var d=0;d<b;d++)a[d].setAttribute("data-selected",0),ea(d),H(),fa();c=[]},N=function(){for(var c=1,e=!1,f=0;f<b;f++)1==a[f].getAttribute("data-selected")&&(e=!0),c==b&&(!1===e?(d=!1,fa()):(d=!0,da())),c++},O=function(a){var b={lat:o[0],lng:o[1],facilities:a.join(",")};$.ajax({url:document.location.origin+"/t--p--f/public/facilities",type:"GET",data:b,dataType:"JSON",success:function(a){console.log(a),K(h),a.length>=1?(v=a,S(),V()):alert("Your chosen facilities are not available at any parks.")},error:function(a){K(h),console.log(a)}})},P=function(a){var b,a=a.replace(/["'()\/.-]/g," "),c=function(a){var b=a.lastIndexOf(" ");return a.substring(0,b)},d=a.split(" "),e=d.slice(-1).pop(),f=c(a);switch(e){case"CC":b="%20Community%20Center";break;case"CRC":b="%20Community%20Recreation%20Center";break;case"RC":b="%20Recreation%20Center";break;case"CSS":b="%20Catholic%20Secondary%20School";break;case"PS":b="%20Public%20School";break;case"CS":b="%20Community%20School";break;case"PARK":case"ES":b="%20Park";break;case"CI":b="%20Collegiate%20Institute";break;case"SS":b="%20Secondary%20School";break;case"JHS":b="%20Junior%20High%20School";break;case"JPS":b="%20Junior%20Public%20School";break;case"TCH":b="%20Toronto%20Community%20Housing";break;default:return encodeURIComponent(a.trim())+"%20Toronto"}return encodeURIComponent(f.trim())+b+"%20Toronto"},Q=function(a){J(i);var b=P(v[a].name);$(".park-images-ul ul").empty(),$.ajax({url:document.location.origin+"/t--p--f/public/bingimages",type:"GET",data:{park:b},dataType:"JSON",success:function(a){K(i),R(a),console.log(a)},error:function(a){K(i),R(null),console.log(a)}})},R=function(a){null===a?$(".park-images-ul ul").append("<div class='no-images'>Unfortunately, there are no images available.</div>"):a.map(function(a,b){$(".park-images-ul ul").append("<a href='"+a.replace(/^http:\/\//i,"https://")+"' target='_blank'><li class='image-item'><img src='"+a.replace(/^http:\/\//i,"https://")+"'/></li></a>")})},S=function(){g?($(".li-bg").removeClass("ani-right").addClass("ani-left"),$(".title").removeClass("ani-fadeIn").addClass("ani-fadeOut"),$(".sub-title").removeClass("ani-fadeIn").addClass("ani-fadeOut"),$(".description").removeClass("ani-fadeIn").addClass("ani-fadeOut"),fa(),setTimeout(function(){$("#home-page").css({display:"none"}),$("#find-parks-page").css({display:"block"}),T()},101),g=!1):($("#find-parks-page").css({display:"none"}),$("#home-page").css({display:"block"}),setTimeout(function(){$(".li-bg").removeClass("ani-left").addClass("ani-right"),$(".title").removeClass("ani-fadeOut").addClass("ani-fadeIn"),$(".sub-title").removeClass("ani-fadeOut").addClass("ani-fadeIn"),$(".description").removeClass("ani-fadeOut").addClass("ani-fadeIn"),N()},0),g=!0)},T=function(){_(),W(),Z(j),Q(j),X(),U(!0,!1)},U=function(a,b){!a||b&&!b||$(".park-distance-ul ul").scrollTo($('li[data-selection-number="'+j+'"]')),$(".park-facilities-ul ul").scrollTo(0),$(".park-images-ul ul").scrollTo(0)},V=function(a){var b=void 0===a?0:a;r.push(j),history.pushState&&history.pushState({data:v,location:o,checkpoint:b,park_memory:r},null,"nearme?q="+b)},W=function(){$(".park-distance-ul ul").empty(),v.map(function(a,b){$(".park-distance-ul ul").append("<li class='distance-item' data-selection-number='"+b+"' data-lat='"+a.latitude+"' data-lng='"+a.longitude+"' data-parkname='"+a.name+"' data-address='"+a.address+"' data-phonenumber='"+a.phone+"' data-postalcode='"+a.postal_code+"'><div class='number-overlay'>"+(b+1)+"</div><div class='number'><strong>"+(b+1)+"</strong> <i class='fa fa-angle-right fa-styling' aria-hidden='true'></i> <span style='opacity: .8;'>"+a.name+"</span></div></li>")});for(var a=document.getElementsByClassName("distance-item"),b=a.length,c=0;c<b;c++)a[c].addEventListener("click",Y,!1);a[j].classList.add("park-selected"),a[j].classList.add("park-selected-official")},X=function(){if(r.length>0)for(var a=0;a<r.length;a++)$('li[data-selection-number="'+r[a]+'"]').addClass("park-selected")},Y=function(a){j=isNaN(a)?parseInt(this.getAttribute("data-selection-number")):a,$(".park-distance-ul>ul>li.park-selected-official").removeClass("park-selected-official"),$(".park-distance-ul>ul>li>.number-zoom").removeClass("number-zoom"),$('li[data-selection-number="'+j+'"]').addClass("park-selected park-selected-official"),$(".park-selected-official>.number-overlay").addClass("number-zoom"),U(!1,!1),ba(j,!0),Z(j),Q(j),w.getStreetView().setVisible(!1),V(j)},Z=function(a){var b=v[a].phone,c="https://www.google.com/maps/dir/"+o[0]+","+o[1]+"/"+v[a].latitude+","+v[a].longitude,d="uber://?action=setPickup&pickup=my_location&dropoff[latitude]="+v[a].latitude+"&dropoff[longitude]="+v[a].longitude+"&dropoff[formatted_address]="+v[a].address,e="",f="",g=0;""!==b&&null!==b?(e='<a href="tel:'+v[a].phone+'">',f="</a>"):b="N/A",$(".park-facilities-ul ul").empty(),$(".park-facilities-ul ul").append("<li><div class='item'><strong>All Facilities</strong></div></li><li><div class='item'><i class='fa fa-angle-right' aria-hidden='true'></i> </div></li>");for(var h in v[a])if(1===v[a][h]&&"id"!==h){var i=0!==g?"<li><div class='item'><i class='fa fa-circle-o fa-styling-small' aria-hidden='true'></i></div></li>":"";$(".park-facilities-ul ul").append(i+"<li><div class='item'>"+aa(h)+"</div></li>"),g++}$("#park-info-name").empty().html(v[a].name),$("#park-info-address").empty().html('<i class="fa fa-map-marker fa-styling" aria-hidden="true"></i> '+v[a].address),$("#park-info-phonenumber").empty().html('<i class="fa fa-phone fa-styling" aria-hidden="true"></i> '+e+b+f),$("#park-info-postalcode").empty().html('<i class="fa fa-home fa-styling" aria-hidden="true"></i> '+v[a].postal_code),$("#park-info-etc #directions").attr("href",c),$("#park-info-etc #uber").attr("href",d)},_=function(){var a,b;w=new google.maps.Map(document.getElementById("google-map"),{zoom:12,center:new google.maps.LatLng(o[0],o[1]),mapTypeId:google.maps.MapTypeId.ROADMAP});var c=new google.maps.InfoWindow;for(t=new google.maps.DirectionsRenderer({preserveViewport:!0}),u=new google.maps.DirectionsService,t.setMap(w),b=0;b<v.length;b++)a=new google.maps.Marker({position:new google.maps.LatLng(v[b].latitude,v[b].longitude),map:w,icon:p}),google.maps.event.addListener(a,"click",function(a,b){return function(){Y(b),U(!0,!0),c.setContent(v[b].name),c.open(w,a)}}(a,b));ba(j)},aa=function(a){return a.split("_").join(" ").replace(/\b\w/g,function(a){return a.toUpperCase()})},ba=function(a,b){var b=void 0!==b,c=new google.maps.LatLng(o[0],o[1]),d=new google.maps.LatLng(v[a].latitude,v[a].longitude);b&&(t.preserveViewport=!1),u.route({origin:c,destination:d,travelMode:google.maps.TravelMode.DRIVING},function(a,b){b===google.maps.DirectionsStatus.OK?t.setDirections(a):console.debug("Directions request failed due to "+b)})},ca=function(a,b,c,d){$("#"+a).css({opacity:b}).attr("data-selected",c),$("#"+a+" > .svg-check").css({display:d}).toggleClass("zoom-check"),"none"===d?($("#"+a).removeClass("li-click"),$("#"+a+" > p").removeClass("li-click-text")):($("#"+a).addClass("li-click"),$("#"+a+" > p").addClass("li-click-text"))},da=function(){$(".fire-btn-shadow").css({display:"block"}).removeClass("zoom-check-shadow-reverse").addClass("zoom-check-shadow"),$(".reset-btn-shadow").css({display:"block"}).removeClass("zoom-check-shadow-reverse").addClass("zoom-check-shadow"),$(".fire-btn").css({display:"block"}).removeClass("zoom-check-reverse").addClass("zoom-check"),$(".reset-btn").css({display:"block"}).removeClass("zoom-check-reverse").addClass("zoom-check")},ea=function(a){$("#"+a).css({opacity:".9"}).attr("data-selected",0),$("#"+a+" > .svg-check").css({display:"none"}).removeClass("zoom-check"),$("#"+a).removeClass("li-click"),$("#"+a+" > p").removeClass("li-click-text")},fa=function(){$(".fire-btn-shadow").addClass("zoom-check-shadow-reverse").removeClass("zoom-check-shadow"),$(".reset-btn-shadow").addClass("zoom-check-shadow-reverse").removeClass("zoom-check-shadow"),$(".fire-btn").addClass("zoom-check-reverse").removeClass("zoom-check"),$(".reset-btn").addClass("zoom-check-reverse").removeClass("zoom-check")};return{populateImages:x,attachFindAll:z,attachEventListeners:y,attachGoClick:A,attachResetClick:B,checkHistoryState:C,loadCheckmarkInit:D}}();TpfHome.populateImages(),TpfHome.attachEventListeners(),TpfHome.attachFindAll(),TpfHome.attachGoClick(),TpfHome.attachResetClick(),TpfHome.checkHistoryState(),TpfHome.loadCheckmarkInit();